@page "/Cart"
@using BlazorUI.Models
@using BlazorUI.Services
@inject BlazorUI.Services.CartService CartService
@inject NavigationManager Nav
<div class="cart-page">
<h2>Shopping Cart</h2>
@if (CartService.Items.Count == 0)
{
    <p>Your Cart is Empty.</p>
}  
else
{
    <table class="cart-table">
        <thead>
            <tr>
                <th>Image</th>
                <th>Product Name</th>
                <th>Size</th>
                <th>Quantity</th>
                <th>Unit Price</th>
                <th>Subtotal</th>
                <th>Remove</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in CartService.Items)
            {
                <tr>
                    <td> <img src="@item.ImageCart" class="cart-img" /></td>
                    <td>@item.CoffeeName</td>
                    <td>
                          <select class ="option" value="@item.Size"
                            @onchange="(e) => OnSizeChanged(item, e)">
                                <option value="S">S</option>
                                <option value="M">M</option>
                                <option value="L">L</option>
                          </select>
                    </td>
                     <td class="quantity-controls">
                        <button @onclick="() => Decrease(item)">-</button>
                        <span>@item.Quantity</span>
                        <button @onclick="() => Increase(item)">+</button>
                    </td>
                    <td >@item.UnitPrice SR</td>
                    <td >@item.TotalPrice</td>
                    <td >
                        <button class="remove-btn" @onclick="() => RemoveItem(item)">
                            üóë
                        </button>
                    </td>
                </tr>
            }
                <tr>
                    <td class="last-row"><h3>Total: @CartService.GetTotal() SR</h3></td>
                </tr>
        </tbody>
    </table>
}
<button class="back-button" @onclick="@(() => Nav.NavigateTo("/menupage"))">
              <b>‚Üê</b> 
            </button>
<div class="nothing"><p></p></div>
</div>

@code
{
    void Increase(CartItem item)
    {
        item.Quantity++;
        item.TotalPrice = item.UnitPrice * item.Quantity;
    }
     void Decrease(CartItem item)
    {
        if (item.Quantity > 1)
        {
            item.Quantity--;
            item.TotalPrice = item.UnitPrice * item.Quantity;
        }
    }
        void RemoveItem(CartItem item)
    {
        CartService.RemoveFromCart(item);
    }
    void OnSizeChanged(CartItem item, ChangeEventArgs e)
    {
        item.Size = e.Value!.ToString()!;

        item.UnitPrice = item.Size switch
        {
            "S" => item.SmallPrice,
            "M" => item.MediumPrice,
            "L" => item.LargePrice,
            _ => item.UnitPrice
        };

        item.TotalPrice = item.UnitPrice * item.Quantity;

        StateHasChanged(); 
    }
}